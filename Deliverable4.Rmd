---
title: "Deliverable 4"
output: github_document
---

# Preprocessing

```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(GGally)
library(caret)
library(kableExtra)
```

```{r read file}
bikedata <- read.csv("day.csv",header=T)
names(bikedata)
```

```{r transform data}
#Transform temp, atemp, windspeed, and humidity to actual values
bikedata <- 
  bikedata %>% mutate(actual.temp = temp*41) %>% 
  mutate(actual.atemp = atemp*50) %>%
  mutate(actual.windspeed = windspeed*67) %>%
  mutate(actual.hum = hum*100)

#Combining summer, fall, and spring, winter
bikedata <- bikedata %>% mutate(season.2 = if_else(season == 2|season==3|season==4,0,if_else(season ==1, 1,NA_real_) ))

#process factor data
bikedata$season <- factor(format(bikedata$season, format="%A"),
                   levels = c("1", "2","3","4") , 
                   labels = c("Spring","Summer","Fall","Winter"))

bikedata$spring <- factor(format(bikedata$season.2, format="%A"),
                   levels = c("0","1") , 
                   labels = c("Not Spring","Spring"))

bikedata$holiday <-factor(format(bikedata$holiday, format="%A"),
                          levels = c("0", "1") , 
                          labels = c("Not Holiday","Holiday"))

bikedata$weathersit <- factor(format(bikedata$weathersit, format="%A"),
                       levels = c("1", "2","3","4") , 
                       labels = c("Good:Clear/Sunny","Moderate:Cloudy/Mist","Bad: Rain/Snow/Fog","Worse: Heavy Rain/Snow/Fog"))

bikedata$workingday <- factor(format(bikedata$workingday, format = "%A"), 
                              levels = c("0", "1"),
                              labels = c("Not WorkingDay", "WorkingDay"))

bikedata$yr <- factor(format(bikedata$yr, format="%A"),
                          levels = c("0", "1") , labels = c("2011","2012"))

bikedata <- bikedata %>% mutate(weekend = if_else(weekday == 0|weekday==6,0,if_else(weekday ==1|weekday==2|weekday==3|weekday==4|weekday==5,1,NA_real_) ))

bikedata$weekend <- factor(format(bikedata$weekend, format = "%A"),
                           levels = c(0,1),
                           labels = c("Weekend", "Weekday"))

bikedata$mnth <- as.factor(bikedata$mnth)



#Generate days from start date values
start = "2011-01-01"
bikedata$date_diff <- as.Date(as.character(bikedata$dteday), format="%Y-%m-%d")-
                  as.Date(start, format="%Y-%m-%d")



```


```{r seperate data}
#Seperate training and validating datas base on year

training_d = bikedata %>%  filter(yr == "2011")
set.seed(42)
#partitiontraining <- createDataPartition(y = train$cnt, p = 0.8, list = F)
#training_d <- train[partitiontraining, ]
#test_d <- train[-partitiontraining, ]
validate_d <- bikedata %>% filter(yr == "2012")
```

```{r}
training.workingday = filter(training_d, workingday == "WorkingDay")
training.nworkingday = filter(training_d, workingday == "Not WorkingDay")
```

# Season

We suspect that there will be a different distribution for casual and registered count in different seasons, therefore we graph them seperately.

```{r}
ggplot(training_d,aes(x=season,y=casual ))+geom_col()
```

```{r}
ggplot(training_d,aes(x=season,y=registered))+geom_col()
```

The graphs show that for both casual and registered bikers, there are the most rental counts during austumn season and the least during the spring season. However, for registered, there are about the same amount of count during summer and winter while for casual there are significantly less counts during winter than during summer. Therefore we think that we should fit different models for registered and casual.

# Holiday
```{r}
ggplot(training_d,aes(x=holiday,y=casual,fill=weekend))+geom_col()
```

```{r}
ggplot(training_d,aes(x=holiday,y=registered,fill=weekend))+geom_col()
```

# Working day

```{r}
ggplot(training_d,aes(x=workingday,y=casual,fill=weekend))+geom_col()
```


```{r}
ggplot(training_d,aes(x=workingday,y=registered,fill=weekend))+geom_col()
```

# Weekday

```{r}
ggplot(training_d,aes(x=weekday,y=casual, fill = season))+geom_col()
```


```{r}
ggplot(training_d,aes(x=weekday,y=registered, fill = season))+geom_col()
```

There seems to be a difference in bike counts for both registered and casual between weekends and not weekends so we generate a new one hot variable. 0 when it is weekday 1 to 5 and 1 if it is 0 or 6. 


# Weather situation 

```{r}
ggplot(training_d,aes(x=weathersit,y=casual,fill=season))+geom_col()
```

```{r}
ggplot(training_d,aes(x=weathersit,y=registered,fill=season))+geom_col()
```

# time graph
```{r}
ggplot(data = training_d, aes(x=date_diff, y = registered)) + geom_col(aes(fill = spring))
```

```{r}
ggplot(data = training_d, aes(x=date_diff, y = registered)) +  geom_col(aes(fill = workingday))
```
```{r}
ggplot(data = training_d, aes(x=date_diff, y = registered)) +  geom_col(aes(fill = mnth))
```
```{r}
ggplot(data = training_d, aes(x=date_diff, y = registered)) +  geom_col(aes(fill = holiday))
```

```{r}
ggplot(data = training_d, aes(x=date_diff, y = casual))  + geom_col(aes(fill = spring))
```

```{r}
ggplot(data = training_d, aes(x=date_diff, y = casual)) +  geom_col(aes(fill = workingday))
```
```{r}
ggplot(data = training_d, aes(x=date_diff, y = casual)) +  geom_col(aes(fill = holiday))
```

# correlation of continuous variables with rental count

```{r}
data <- data.frame(training_d$casual, training_d$actual.hum, training_d$actual.temp, training_d$actual.windspeed, training_d$actual.atemp)

data = data%>% rename( casual = training_d.casual, humidity= training_d.actual.hum,  temperature= training_d.actual.temp, windspeed = training_d.actual.windspeed, feeltemp = training_d.actual.atemp)

ggpairs(data, lower = list(continuous = wrap("points", alpha = 0.3, size= 0.7)))
```

```{r}
data <- data.frame(training_d$registered, training_d$actual.hum, training_d$actual.temp, training_d$actual.windspeed, training_d$actual.atemp)

data = data%>% rename( registered = training_d.registered, humidity= training_d.actual.hum,  temperature= training_d.actual.temp, windspeed = training_d.actual.windspeed, feeltemp = training_d.actual.atemp)

ggpairs(data, lower = list(continuous = wrap("points", alpha = 0.3, size= 0.7)))
```

The scatter correlation suggests that feel temperature and actual temperature are highly correlated because the scatter plot of temperature against feel temperature resembles a straight linear line and the correlation between them is 0.996, which is extremely close to 1. Therefore we will exclude feel temperature from our model to avoid collinearity. 

Humidity and casual and registered counts are not correlated as suggested by the low correlation value of -0.032 and 0.019 respectively. The scatter plot of casual and registered counts against humidity also shows a slope of around 0. Therefore humidity will likely not explain much of the variation in rental counts and we will exclude it from our model. 

The scatter plot of causual and registered against temperature also suggests a non linear relationship between temperature and rental counts because the plots decreases above a certain temperature. Therefore we should add higher temperature powers. 


# correlation between season and temperature

```{r}
ggplot(training_d,aes(x=season,y=actual.temp))+geom_boxplot()
```



The box plot of season against temperature suggests that there is a correlation between seasons and temperature. Autumn has the highest temperature and spring has the lowest temperature. We might want to exclude season to avoid collinearity in our model. 

# temperature and rental counts

```{r higher power regression with temperature}
m.quadls_casual <- lm(training_d$casual ~ training_d$actual.temp + I(training_d$actual.temp^2))
m.quadls_registered <- lm(training_d$registered ~ training_d$actual.temp + I(training_d$actual.temp^2))
```


```{r}
ggplot(training_d, aes(x = actual.temp)) + geom_point(aes(y = registered,  color = "registered"), shape = 1) + geom_point(aes(y = casual,  color = "casual"), shape = 1) +   geom_line(data = fortify(m.quadls_casual), aes(x = training_d$actual.temp, y = .fitted), color = "red") + geom_line(data = fortify(m.quadls_registered), aes(x = training_d$actual.temp, y = .fitted), color = "blue") + labs(title = "Scatter plot with fitted quadratic model")
```

Therefore we conclude that we should include a quadratic term on temperature. 



```{r}
m.casual.workingday <- lm(training.workingday$casual ~ training.workingday$actual.temp)
                        
m.quadls_casual.nworkingday <- lm(training.nworkingday$casual ~ training.nworkingday$actual.temp + I(training.nworkingday$actual.temp^2))

```

```{r}
ggplot(training.workingday, aes(x = actual.temp)) + geom_point(aes(y = casual,  color = "casual"), shape = 1) +   geom_abline(slope = coef(m.casual.workingday)[[2]], intercept = coef(m.casual.workingday)[[1]], color = "red")  + labs(title = "Scatter plot of casual counts on workingdays with fitted model")

```
```{r}
ggplot(training.nworkingday, aes(x = actual.temp)) + geom_point(aes(y = casual,  color = "casual"), shape = 1) + geom_line(data = fortify(m.quadls_casual.nworkingday), aes(x = training.nworkingday$actual.temp, y = .fitted), color = "red")+ labs(title = "Scatter plot of casual counts on not working days with fitted quadratic model")
```




```{r}
summary(m.casual.workingday)

```

```{r}
summary(m.quadls_casual.nworkingday)
```

```{r}
ggplot(training_d, aes(x = actual.temp)) + geom_point(aes(y = registered,  color = weekend), shape = 1) + labs(title = "Scatter plot of registered counts on weekdays andnon-workingdays")

```

```{r}
m.registered.workingday <- lm(training.workingday$registered ~ training.workingday$actual.temp + I(training.workingday$actual.temp^2))
                        
m.registered.nworkingday <- lm(training.nworkingday$registered ~ training.nworkingday$actual.temp + I(training.nworkingday$actual.temp^2))

```

```{r}
ggplot(training_d, aes(x = actual.temp)) + geom_point(aes(y = registered,  color = weekend), shape = 1) + geom_line(data = fortify(m.registered.workingday), aes(x = training.workingday$actual.temp, y = .fitted), color = "blue") +  geom_line(data = fortify(m.registered.nworkingday), aes(x = training.nworkingday$actual.temp, y = .fitted), color = "red") + labs(title = "Scatter plot of casual counts on weekdays and weekends with fitted model")
```

```{r}
ggplot(training.workingday, aes(x = actual.temp, y = registered, color = spring)) + geom_point()
```
```{r}
ggplot(training.nworkingday, aes(x = actual.temp, y = registered, color = spring)) + geom_point()
```

```{r}
ggplot(training.workingday, aes(x = actual.temp, y = casual, color = spring)) + geom_point()
```

```{r}
ggplot(training.nworkingday, aes(x = actual.temp, y = casual, color = spring)) + geom_point()
```

# Wind speed and rental counts

```{r}
m.lin_casual <- lm(training_d$casual ~ training_d$actual.windspeed)
m.lin_registered <- lm(training_d$registered ~ training_d$actual.windspeed)
```

```{r}
ggplot(training_d, aes(x = actual.windspeed)) + geom_point(aes(y = registered,  color = "registered"), shape = 1) + geom_point(aes(y = casual,  color = "casual"), shape = 1) +   geom_line(data = fortify(m.lin_casual), aes(x = training_d$actual.windspeed, y = .fitted), color = "red") + geom_line(data = fortify(m.lin_registered), aes(x = training_d$actual.windspeed, y = .fitted), color = "blue") + labs(title = "Scatter plot with fitted quadratic model")
```

```{r}
ggplot(training_d, aes(x = actual.windspeed)) + geom_point(aes(y = registered,  color = workingday), shape = 1) + labs(title = "Scatter plot of registered counts on workingdays and non-workingdays") 
```

```{r}
ggplot(training_d, aes(x = actual.windspeed)) + geom_point(aes(y = casual,  color = workingday), shape = 1) + labs(title = "Scatter plot of casual counts on workingdays and non-workingdays")
```

```{r}
m.casual.workingday <- lm(training.workingday$casual ~ training.workingday$actual.windspeed)
summary(m.casual.workingday)
```

```{r}
m.casual.nworkingday <- lm(training.nworkingday$casual ~ training.nworkingday$actual.windspeed)
summary(m.casual.nworkingday)
```

```{r}
m.registered.workingday <- lm(training.workingday$registered ~ training.workingday$actual.windspeed)
summary(m.registered.workingday)
```

```{r}
m.registered.nworkingday <- lm(training.nworkingday$registered ~ training.nworkingday$actual.windspeed)
summary(m.registered.nworkingday)
```

# Model
```{r}
model.casual.workingday <- lm(casual ~ actual.windspeed + actual.temp + weathersit , data = training.workingday)

model.registered.workingday <- lm(registered ~  actual.temp + (spring*I(actual.temp^2)) +  weathersit + spring +date_diff+(spring*actual.temp), data = training.workingday)
```


```{r}
summary(model.casual.workingday)
```

```{r}
summary(model.registered.workingday)
```

```{r}
model.casual.nworkingday <- lm(casual ~ actual.windspeed + actual.temp + (spring*I(actual.temp^2)) + weathersit + spring +(spring*actual.temp) , data = training.nworkingday)

model.registered.nworkingday <- lm(registered ~ actual.temp + I(actual.temp^2) +  weathersit, data = training.nworkingday)
```

```{r}
summary(model.casual.nworkingday)
```

```{r}
summary(model.registered.nworkingday)
```



All of the p values on the coefficients of the regressors are less than 0.005. Therefore we are confident that all the regressors have an effect on the rental counts individually. Furthermore, the p value of the F-statistic is less than 0.005. Therefore we are very confident that all the regressors are jointly significant. The R^2 value is arount 0.7, so the models explain around 70 percent of the variation in rental counts. (explain more in paper).

# Model diagnosis

```{r}
StanRes.casual.workingday <- rstandard(model.casual.workingday)
StanRes.registered.workingday <- rstandard(model.registered.workingday)
StanRes.casual.nworkingday <- rstandard(model.casual.nworkingday)
StanRes.registered.nworkingday <- rstandard(model.registered.nworkingday)
```

```{r}
ggplot() +
geom_point(data=training.workingday, aes(x=casual, y=StanRes.casual.workingday, color = "MLS"), size = 1) +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') +
scale_color_manual(name = element_blank(), labels = c("MLS"), values = c("blue")) +
labs(y = "Standarized Residual") + ggtitle("Standarized Residuals MLS Plot for casual bikers on workingdays")
```

```{r}
ggplot() +
geom_point(data=training.workingday, aes(x=registered, y=StanRes.registered.workingday, color = "MLS"), size = 1) +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') +
scale_color_manual(name = element_blank(), labels = c("MLS"), values = c("blue")) +
labs(y = "Standarized Residual") + ggtitle("Standarized Residuals MLS Plot for registered bikers on workingdays")
```

```{r}
Fitted_casual.workingday = fitted(model.casual.workingday)

ggplot() +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') + geom_point(aes(x=Fitted_casual.workingday, y=StanRes.casual.workingday, color = "MLS"), size = 1) +
labs(y = "Standarized Residual") + labs(x = "Fitted value") +
ggtitle("Standarized Residuals WLS Plot (Fitted) for casual bikers on workingdays") 
```

```{r}
Fitted_registered.workingday = fitted(model.registered.workingday)

ggplot() +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') + geom_point(aes(x=Fitted_registered.workingday, y=StanRes.registered.workingday, color = "MLS"), size = 1) +
labs(y = "Standarized Residual") + labs(x = "Fitted value") +
ggtitle("Standarized Residuals WLS Plot (Fitted) for registered bikers on workingdays") 
```


```{r}
ggplot() +
geom_point(data=training.nworkingday, aes(x=casual, y=StanRes.casual.nworkingday, color = "MLS"), size = 1) +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') +
scale_color_manual(name = element_blank(), labels = c("MLS"), values = c("blue")) +
labs(y = "Standarized Residual") + ggtitle("Standarized Residuals MLS Plot for casual bikers onnon-workingdays")
```

```{r}
ggplot() +
geom_point(data=training.nworkingday, aes(x=registered, y=StanRes.registered.nworkingday, color = "MLS"), size = 1) +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') +
scale_color_manual(name = element_blank(), labels = c("MLS"), values = c("blue")) +
labs(y = "Standarized Residual") + ggtitle("Standarized Residuals MLS Plot for registered bikers on non-workingdays")
```

```{r}
Fitted_casual.nworkingday = fitted(model.casual.nworkingday)

ggplot() +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') + geom_point(aes(x=Fitted_casual.nworkingday, y=StanRes.casual.nworkingday, color = "MLS"), size = 1) +
labs(y = "Standarized Residual") + labs(x = "Fitted value") +
ggtitle("Standarized Residuals WLS Plot (Fitted) for casual bikers on non-workingdays") 
```

```{r}
Fitted_registered.nworkingday = fitted(model.registered.nworkingday)

ggplot() +
geom_hline(yintercept=2,color='blue') + geom_hline(yintercept=-2, color='blue') + geom_point(aes(x=Fitted_registered.nworkingday, y=StanRes.registered.nworkingday, color = "MLS"), size = 1) +
labs(y = "Standarized Residual") + labs(x = "Fitted value") +
ggtitle("Standarized Residuals WLS Plot (Fitted) for registered bikers on workingdays") 
```


```{r}
p <- ggplot(data.frame(StanRes.casual.workingday), aes(sample = StanRes.casual.workingday)) +
ggtitle("QQ MLS Plot for casual bikers on workingdays")
p + stat_qq() + stat_qq_line()
```

```{r}
p <- ggplot(data.frame(StanRes.registered.workingday), aes(sample = StanRes.registered.workingday)) +
ggtitle("QQ MLS Plot for registered bikers on workingdays")
p + stat_qq() + stat_qq_line()
```

```{r}
p <- ggplot(data.frame(StanRes.casual.nworkingday), aes(sample = StanRes.casual.nworkingday)) +
ggtitle("QQ MLS Plot for casual bikers on non-workingdays")
p + stat_qq() + stat_qq_line()
```

```{r}
p <- ggplot(data.frame(StanRes.registered.nworkingday), aes(sample = StanRes.registered.nworkingday)) +
ggtitle("QQ MLS Plot for registered bikers on non-workingdays")
p + stat_qq() + stat_qq_line()
```



The fitted residual plot and the residual plot suggest that there are extreme outliers in the casual model and that the residual for both models are not evenly distributed around 0, therefore suggesting that there exists heterogeneity in the models. 

The QQ plots show a line that is roughly straight, therefore we conclude that the data of registered bikers come from a normally distributed sample. We can also conclude the same for casual bikers, however, there exists some data points that do not come from a normal distribution as indicated by the few datapoints that deviate significantly from the straight line.


```{r}
p1 <- ggplot(data = data.frame(StanRes.casual.workingday), aes(x = StanRes.casual.workingday)) + geom_histogram(bins = 100)

p1
```

```{r}
p2 <- ggplot(data = data.frame(StanRes.casual.nworkingday), aes(x = StanRes.casual.nworkingday)) + geom_histogram(bins = 100)

p2
```

```{r}
p3 <- ggplot(data = data.frame(StanRes.registered.workingday), aes(x = StanRes.registered.workingday)) + geom_histogram(bins = 100)

p3
```

```{r}
p4 <- ggplot(data = data.frame(StanRes.registered.nworkingday), aes(x = StanRes.registered.nworkingday)) + geom_histogram(bins = 100)

p4
```

# Validation
```{r}

validate.nworkingday = filter(validate_d, workingday == "Not WorkingDay")
validate.workingday = filter(validate_d, workingday == "WorkingDay")
```

```{r}
p.casual.workingday <- predict(model.casual.workingday, validate.workingday)
error.casual.workingday <- (p.casual.workingday- validate.workingday$casual)
RMSE_validation.caual.workingday <- sqrt(mean(error.casual.workingday^2))
RMSEWLS.casual.workingday <- sqrt(mean(resid(model.casual.workingday)^2))

p.casual.nworkingday <- predict(model.casual.nworkingday, validate.nworkingday)
error.casual.nworkingday <- (p.casual.nworkingday- validate.nworkingday$casual)
RMSE_validation.caual.nworkingday <- sqrt(mean(error.casual.nworkingday^2))
RMSEWLS.casual.nworkingday <- sqrt(mean(resid(model.casual.nworkingday)^2))

```

Square root mean square error for validation data set
```{r}
RMSE_validation.caual.workingday
RMSE_validation.caual.nworkingday
```
square root mean square error for training data set
```{r}
RMSEWLS.casual.workingday
RMSEWLS.casual.nworkingday
```

```{r}
p.registered.workingday <- predict(model.registered.workingday, se.fit = TRUE, validate.workingday)
error.registered.workingday <- (p.registered.workingday$fit- validate.workingday$registered)
RMSE_validation.registered.workingday <- sqrt(mean(error.registered.workingday^2))
RMSEWLS.registered.workingday <- sqrt(mean(resid(model.registered.workingday)^2))

p.registered.nworkingday <- predict(model.registered.nworkingday, se.fit = TRUE, validate.nworkingday)
error.registered.nworkingday <- (p.registered.nworkingday$fit- validate.nworkingday$registered)
RMSE_validation.registered.nworkingday <- sqrt(mean(error.registered.nworkingday^2))
RMSEWLS.registered.nworkingday <- sqrt(mean(resid(model.registered.nworkingday)^2))

```

Square root mean square error for validation data set

```{r}
RMSE_validation.registered.workingday
RMSE_validation.registered.nworkingday
```
square root mean square error for training data set

```{r}
RMSEWLS.registered.workingday
RMSEWLS.registered.nworkingday
```


Relative mean square error
```{r}
mean((error.casual.workingday)^2) / mean((validate.workingday$casual)^2)
mean((error.casual.nworkingday)^2) / mean((validate.nworkingday$casual)^2)
mean((error.registered.workingday)^2) / mean((validate.workingday$registered)^2)
mean((error.registered.nworkingday)^2) / mean((validate.nworkingday$registered)^2)
```

Our model predicts the bike data in 2012 with mean error of 23 percent and 16 percent within the true value of casual and registered counts respectively. However, our model have twice as large of square root of mean square error with the validation data set than with the training data set. 

```{r}
validate.workingday <- validate.workingday %>% mutate(prediction_registered.workingday = predict(model.registered.workingday, validate.workingday)) %>% mutate(prediction_casual.workingday = predict(model.casual.workingday, validate.workingday))

validate.nworkingday <- validate.nworkingday %>% mutate(prediction_registered.nworkingday = predict(model.registered.nworkingday, validate.nworkingday)) %>% mutate(prediction_casual.nworkingday = predict(model.casual.nworkingday, validate.nworkingday))
```


```{r}
ggplot(validate.workingday, aes(x = casual, y = prediction_casual.workingday)) + geom_point() +
geom_abline(intercept = 0, slope = 1) +
ggtitle("Validation Casual vs Prediction on workingdays")
```

```{r}
ggplot(validate.nworkingday, aes(x = casual, y = prediction_casual.nworkingday)) + geom_point() +
geom_abline(intercept = 0, slope = 1) +
ggtitle("Validation Casual vs Prediction onnon-workingdays")
```

```{r}
ggplot(validate.workingday, aes(x = registered, y = prediction_registered.workingday)) + geom_point() +
geom_abline(intercept = 0, slope = 1) +
ggtitle("Validation Registered vs Prediction on workingdays")
```

```{r}
ggplot(validate.nworkingday, aes(x = registered, y = prediction_registered.nworkingday)) + geom_point() +
geom_abline(intercept = 0, slope = 1) +
ggtitle("Validation Registered vs Prediction onnon-workingdays")
```

```{r}
ggplot(data = validate.workingday, aes(x = instant)) +
geom_line(aes(y = casual, color = "casual")) +
geom_line(aes(y = prediction_casual.workingday, color="Prediction"), linetype="twodash") +
scale_color_manual(name = element_blank(), labels = c("casual","Prediction"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("Validation of casual bikers on workingdays") 
```


```{r}
ggplot(data = validate.nworkingday, aes(x = instant)) +
geom_line(aes(y = casual, color = "casual")) +
geom_line(aes(y = prediction_casual.nworkingday, color="Prediction"), linetype="twodash") +
scale_color_manual(name = element_blank(), labels = c("casual","Prediction"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("Validation of casual bikers on non-workingdays") 
```

```{r}
ggplot(data = validate.workingday, aes(x = instant)) +
geom_line(aes(y = registered, color = "registered")) +
geom_line(aes(y = prediction_registered.workingday, color="Prediction"), linetype="twodash") +
scale_color_manual(name = element_blank(), labels = c("casual","registered"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("Validation of registered bikers on workingdays")
```

```{r}
ggplot(data = validate.nworkingday, aes(x = instant)) +
geom_line(aes(y = registered, color = "registered")) +
geom_line(aes(y = prediction_registered.nworkingday, color="Prediction"), linetype="twodash") +
scale_color_manual(name = element_blank(), labels = c("registered","Prediction"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("Validation of registered bikers on non-workingdays")
```
```{r}
validate.nworkingday<- validate.nworkingday %>% mutate(pred.total = prediction_registered.nworkingday+prediction_casual.nworkingday)

validate.workingday<- validate.workingday %>% mutate(pred.total = prediction_registered.workingday+prediction_casual.workingday)

temp1<- subset(validate.nworkingday, select = c(instant,pred.total, cnt))
temp2<- subset(validate.workingday, select = c(instant,pred.total, cnt))
total<- rbind(temp1, temp2)

training.workingday <- training.workingday %>% mutate(prediction_registered.workingday = predict(model.registered.workingday, training.workingday)) %>% mutate(prediction_casual.workingday = predict(model.casual.workingday, training.workingday))

training.nworkingday <- training.nworkingday %>% mutate(prediction_registered.nworkingday = predict(model.registered.nworkingday, training.nworkingday)) %>% mutate(prediction_casual.nworkingday = predict(model.casual.nworkingday, training.nworkingday))

training.nworkingday<- training.nworkingday %>% mutate(pred.total = prediction_registered.nworkingday+prediction_casual.nworkingday)

training.workingday<- training.workingday %>% mutate(pred.total = prediction_registered.workingday+prediction_casual.workingday)

temp1<- subset(training.nworkingday, select = c(instant,pred.total, cnt))
temp2<- subset(training.workingday, select = c(instant,pred.total, cnt))
training.total<- rbind(temp1, temp2)
```

```{r}
ggplot(data = total, aes(x = instant)) +
geom_line(aes(y = cnt, color = "GroundTruth")) +
geom_line(aes(y = pred.total, color="Prediction")) +
scale_color_manual(name = element_blank(), labels = c("GroundTruth","Prediction"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("Validation of total rental counts")
```

```{r}
error <- (total$pred.total- total$cnt)
RMSE_validation <- sqrt(mean(error^2))
RMSE_training <- sqrt(mean((training.total$pred.total- training.total$cnt)^2))

```

```{r}
RMSE_validation
RMSE_training
mean((training.total$pred.total- training.total$cnt)^2) / mean((training.total$cnt)^2)
```

```{r}
ggplot(data = training.total, aes(x = instant)) +
geom_line(aes(y = cnt, color = "GroundTruth")) +
geom_line(aes(y = pred.total, color="Prediction")) +
scale_color_manual(name = element_blank(), labels = c("GroundTruth","Prediction"),
values = c("darkred", "steelblue")) + labs(y = "") +
ggtitle("training of total rental counts")
```


